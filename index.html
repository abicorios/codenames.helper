<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Codenames Helper</title>
    <script src="lodash.min.js"></script>
    <style>
        table {
            border-spacing: 8px;
        }

        td {
            background-color: #ccc;
            padding: 5px;
            font-size: 250%;
            text-align: center;
        }

        textarea {
            width: 500px;
            height: 200px;
        }

        div {
            width: 50%;
            margin: 0 auto;
        }

        .output {
            height: auto;
            display: none;
        }

        .note {
            display: none;
            margin: 0;
        }
    </style>
</head>
<body>
<div>
    <h3>Автоматическое форматирование перечня слов для игры Codenames</h3>
    <p>Добавьте перечень слов:</p>
    <textarea id="words_input"></textarea>
    <p>Разделители: <input id="separators" type="text" value=" ,"
       title="перечень всех разрешенных альтернативных разделителей слов, например пробел и запятая, значит без разницы пробелами или запятыми разделять">
    </p>
    <p>Перемешать: <input id="shuffle" type="checkbox" checked></p>
    <p>Заметки: <input id="show_notes" type="checkbox"></p>
    <p id="table"></p>
    <p><textarea id="words_list" disabled class="output"></textarea></p>
    <p><a href="https://github.com/abicorios/codenames.helper">Исходный код</a></p>
</div>
<script>
    const max_count_of_words = 5 * 5;
    const table_start = `<table>`;
    const table_end = `</table>`;
    const note = `<p style="margin: 0;" class="note"><input type="text" style="width: 1px;"></p>`;
    const check_notes = () => {
        if(document.querySelector("#show_notes").checked) {
            Array.from(document.querySelectorAll(".note")).forEach(this_note => {
                this_note.style.display = "block";
            })
        } else {
            Array.from(document.querySelectorAll(".note")).forEach(this_note => {
                this_note.style.display = "none";
            })
        }
    }
    const make_table = () => {
        const input = document.getElementById("words_input").value;
        const split_symbols = document.getElementById("separators").value;
        const splitter = new RegExp(`[\\n${split_symbols}]+`);
        let ar_input = input.split(splitter);
        ar_input = _.compact(ar_input);
        if (document.getElementById("shuffle").checked) {
            ar_input = _.shuffle(ar_input);
        }
        if (ar_input.length > max_count_of_words) {
            ar_input = _.slice(ar_input, 0, max_count_of_words);
        }
        const matrix_words = _.chunk(ar_input, 5)
        let table_middle = "";
        matrix_words.forEach(row => {
            table_middle += "<tr>";
            row.forEach(item => {
                item = _.trim(item);
                item = item.replace(/,/g, "");
                table_middle += `<td>${item}${note}</td>`;
            });
            table_middle += "</tr>";
        });
        const table = table_start + table_middle + table_end;
        document.getElementById("table").innerHTML = table;
        let words_list = matrix_words.map(row => row.join(", ")).join(",\n");
        words_list = words_list.replace(/,,+/g, ",");
        const output = document.getElementById("words_list");
        if(ar_input.length) {
            output.style.display = "block";
        } else {
            output.style.display = "none";
        }
        output.value = words_list;
        output.style.height = 'auto';
        output.style.height = output.scrollHeight+"px";
        Array.from(document.getElementsByTagName("td")).forEach(td => {
            td.querySelector("input").style.width = td.offsetWidth - 20 + "px";
        });
        check_notes();
    }
    document.getElementById("words_input").addEventListener("keyup", make_table);
    document.getElementById("separators").addEventListener("keyup", make_table);
    document.getElementById("shuffle").addEventListener("change", make_table);
    document.querySelector("#show_notes").addEventListener("change",check_notes);
</script>
</body>
</html>
